<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}R2C Flight Tracker{% endblock %}</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
      .dashboard-container {
	  max-width: 1000px;
	  margin: 0 auto;
	  padding: 20px;
      }
      .section {
	  margin-bottom: 50px;
      }
      table {
	  width: 100%;
	  border-collapse: colapse;
	  background: white;
	  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      th, td {
	  padding: 12px;
	  text-align: left;
	  white-space: nowrap;
	  border-bottom: 1px solid #ddd;
      }
      th {
	  background-color: #2c3e50;
	  color: white;
      }
      body {
	  font-family: sans-serif;
	  margin: 20px;
	  background: #f4f4f4;
      }
      .stats-grid {
	  display: grid;
	  grid-template-columns: repeat(3, 1fr);
	  gap: 20px; margin-bottom: 20px;
      }
      .card {
	  background: white;
	  padding: 20px;
	  border-radius: 8px;
	  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
	  text-align: center;
      }
      h2 {
	  color: #2c3e50;
      }
      .alert { border: black; padding:5px; border-radius:5px; }
      .alert.alert-info    { background:#9747c9; color: white; }
      .alert.alert-success { background:#07de27; color: black; }
      .alert.alert-warning { background:#e30b8d; color: white; }
    </style>
    <link rel="icon" type="image/png" href="/static/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="shortcut icon" href="/static/favicon.ico" />
  </head>

  <main>
    {% for msg in get_flashed_messages(request) %}
    <div class="alert alert-{{ msg.category }}">
      {{ msg.message }}
    </div>
    {% endfor %}
    {% block content %}

    {% endblock %}
  </main>
  
<script>
  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const socket = new WebSocket(`${protocol}//${window.location.host}/ws`);
      
  socket.onmessage = function(event) {
      if (event.data === "refresh") {
          window.location.reload(); // Force the browser to refresh
      }
  };

  document.addEventListener("DOMContentLoaded", function() {
      // Find all elements marked for conversion:
      const timeElements = document.querySelectorAll('.local-datetime')

      // Create a formatter that uses the Browser's default (no timezone option)
      const formatter = new Intl.DateTimeFormat(undefined, {
	  day: '2-digit', month: 'short', year: '2-digit',
	  hour: '2-digit', minute: '2-digit', hour12: false
      });
      
      timeElements.foreach(el => {
	  const timeStr = el.getAttribute('data-utc');
	  if (timeStr) {
	      // without 'Z' or '+HH:MM', Date() treats timeStr as local system time.
	      const date = new Date(timeStr);
	      
	      const formatted = formatter.format(date).replace(',', '').replace(' ', '@');
	      el.textContent = formatted;
	  }
      });
  });
</script>





    <footer style="margin-top: 50px; text-align: center; border-top: 1px solid #ddd; padding-top: 20px;">
      <p><a href="/flightlogs/list" style="color: #bdc3c7; text-decoration: none; font-size: 0.8em;">Admin Flight Logs</a></p>
      <p><a href="/admin" style="color: #bdc3c7; text-decoration: none; font-size: 0.8em;">Admin Access</a></p>
      <p><a href="/export" style="color: #bdc3c7; text-decoration: none; font-size: 0.8em;">Export as CSV</a></p>
      <p><a href="/docs" style="color: #bdc3c7; text-decoration: none; font-size: 0.8em;">Docs</a></p>
    </footer>
